var bind=function(t,i){return function(){return t.apply(i,arguments)}},extend=function(t,i){function e(){this.constructor=t}for(var s in i)hasProp.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t},hasProp={}.hasOwnProperty;window.onload=function(){var t,i,e;return e=function(t){function i(){return this.start=bind(this.start,this),this.update=bind(this.update,this),i.__super__.constructor.apply(this,arguments)}return extend(i,t),i.prototype.defaults={moscowOffset:108e5,leftTime:0,startTime:"00:00:00",endTime:"00:00:00",started:!1},i.prototype.initialize=function(){},i.prototype.update=function(){var t,i,e;return t=(new Date).getTime(),e=this.get("startTime")-t,i=this.get("endTime")-t,this.set("timeLeft",i),this.set("toStart",e),e>6e4?this.set("toStartStr",this.parseHours(e)+":"+this.parseMunutes(e)):this.set("toStartStr","минуту"),this.set("seconds",this.parseSeconds(i)),this.set("minutes",this.parseMunutes(i)),this.set("hours",this.parseHours(i)),i<=0?this.trigger("timer:finished"):(e>0?this.trigger("timer:notstarted"):(this.get("started")||(this.set("started",!0),this.trigger("timer:started"),Backbone.trigger("actiontimer:started")),i>0&&this.trigger("timer:updated")),this.timer=setTimeout(this.update,1e3))},i.prototype.start=function(){return this.update(),this.trigger("timer:inited")},i.prototype.parseSeconds=function(t){return("0"+Math.floor(t%6e4/1e3)).slice(-2)},i.prototype.parseMunutes=function(t){return("0"+Math.floor(t%36e5/6e4)).slice(-2)},i.prototype.parseHours=function(t){return Math.floor(t/36e5)%24},i}(Backbone.Model),t=function(t){function i(){return this.finish=bind(this.finish,this),this.update=bind(this.update,this),this.notstart=bind(this.notstart,this),this.start=bind(this.start,this),this.init=bind(this.init,this),i.__super__.constructor.apply(this,arguments)}return extend(i,t),i.prototype.initialize=function(){return this.listenTo(this.model,"timer:inited",this.init),this.listenTo(this.model,"timer:started",this.start),this.listenTo(this.model,"timer:notstarted",this.notstart),this.listenTo(this.model,"timer:updated",this.update),this.listenTo(this.model,"timer:finished",this.finish),this.$timer=this.$(".js-happyhours-timer"),this.model.start()},i.prototype.init=function(){return this.$timer.show()},i.prototype.start=function(){return this.$el.addClass("b-happy-hours__slider-item--current"),this.$el.addClass("b-happy-hours__slider-item--active")},i.prototype.notstart=function(){return this.$timer.html("Акция стартует через "+this.model.get("toStartStr"))},i.prototype.update=function(){if(this.model.get("timeLeft")>0&&this.model.get("toStart")<=0)return this.$timer.html('<div class="e-timer-item">'+this.model.get("hours")+'</div> <div class="e-timer-item">'+this.model.get("minutes")+'</div> <div class="e-timer-item">'+this.model.get("seconds")+"</div>")},i.prototype.finish=function(){return this.$el.removeClass("b-happy-hours__slider-item--current"),this.$el.removeClass("b-happy-hours__slider-item--active"),this.$el.addClass("b-happy-hours__slider-item--done"),this.$timer.text("Акция завершена")},i}(Backbone.View),i=function(i){function s(){return this.arrowsCheckState=bind(this.arrowsCheckState,this),this.slideToActive=bind(this.slideToActive,this),this.arrowClick=bind(this.arrowClick,this),this.reinitialize=bind(this.reinitialize,this),s.__super__.constructor.apply(this,arguments)}return extend(s,i),s.prototype.events={"click .js-slider-arrow":"arrowClick"},s.prototype.initialize=function(){return $(window).bind("resize",_.throttle(this.reinitialize)),this.listenTo(Backbone,"actiontimer:started",this.slideToActive),this.$items=this.$(".b-happy-hours__slider-item"),this.$nextArrow=this.$el.find('.js-slider-arrow[data-direction="1"]'),this.$prevArrow=this.$el.find('.js-slider-arrow[data-direction="-1"]'),this.itemWidth=this.$items.outerWidth(!0),this.activeItemWidth=this.itemWidth+170,this.itemsCount=this.$items.length,this.sliderTrack=this.$(".js-slider-track"),this.sliderWidth=this.$el.outerWidth(!0),this.trackWidth=170+_.reduce(this.$items,function(t,i){return t+$(i).outerWidth(!0)},0),this.currOffset=0,this.sliderTrack.css("width",this.trackWidth+"px"),this.$items.each(function(i){return function(s,r){var h,o;return h=new e({startTime:i.parseTimeAttr(r.dataset.starttime),endTime:i.parseTimeAttr(r.dataset.endtime)}),o=new t({el:r,model:h})}}(this)),this.$itemActive=this.$(".b-happy-hours__slider-item--active"),console.log("@$itemActive",this.$itemActive),this.arrowsCheckState(),_.delay(this.slideToActive,2e3)},s.prototype.reinitialize=function(){return this.activeItemWidth=this.$itemActive.outerWidth(!0),this.itemWidth=this.$items.outerWidth(!0),this.sliderWidth=this.$el.outerWidth(!0),this.trackWidth=_.reduce(this.$items,function(t,i){return t+$(i).outerWidth(!0)},0),this.sliderTrack.css("width",this.trackWidth+"px"),this.arrowsCheckState(),this.slideToActive()},s.prototype.parseTimeAttr=function(t){var i,e;return i=new Date,e=t.split(":"),i.setSeconds(e[2]),i.setMinutes(e[1]),i.setHours(e[0]),i},s.prototype.arrowClick=function(t){return this.$itemActive=this.$(".b-happy-hours__slider-item--active"),this.$itemActive.removeClass("b-happy-hours__slider-item--active"),parseInt(t.currentTarget.getAttribute("data-direction"))>0?this.$itemActive=this.$itemActive.next():this.$itemActive=this.$itemActive.prev(),this.$itemActive&&this.$itemActive.length&&this.$itemActive.addClass("b-happy-hours__slider-item--active"),this.arrowsCheckState(),this.slideToActive()},s.prototype.slideToActive=function(){return this.$itemActive=this.$(".b-happy-hours__slider-item--active"),this.currOffset=this.$itemActive.index()*this.itemWidth+this.activeItemWidth/2-this.sliderWidth/2,this.sliderTrack.css({transform:"translateX("+this.currOffset*-1+"px)"})},s.prototype.arrowsCheckState=function(){return this.$itemActive.index()<=0?this.$prevArrow.hide():this.$prevArrow.show(),this.$itemActive.index()>=this.itemsCount-1?this.$nextArrow.hide():this.$nextArrow.show()},s}(Backbone.View),LMDA.Events.on("app:ready",function(){var t;return t=new i({el:".js-happy-hours-slider"})})};